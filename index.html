<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>4-Generation Rabbit Pedigree (Android)</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: white;
      font-family: Arial, sans-serif;
    }

    #toolbar {
      position: sticky;
      top: 0;
      z-index: 10;
      background: white;
      padding: 10px;
      border-bottom: 1px solid #d0d0d0;
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
    }

    #export-btn {
      padding: 10px 16px;
      background-color: #4A4A4A;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }

    #container {
      width: 100%;
      overflow-x: auto;
      overflow-y: hidden;
      background: white;
      display: flex;
      justify-content: center;
    }

    /* Keep SVG stable for Android WebView */
    svg {
      display: block;
      width: 1200px;       /* stable layout on phones; user can scroll horizontally */
      height: auto;
      background: white;
      margin: 0 auto;
    }

    #background-image {
      pointer-events: none;
    }

    .box {
      width: 320px;
      height: 125px;
      rx: 10;
      ry: 10;
      stroke: black;
      stroke-width: 1.5;
      fill: white;
    }

    .male { fill: #cce5ff; }
    .female { fill: #f8d7da; }

    text {
      font-size: 14px;
      font-family: Arial, sans-serif;
    }

    .name { font-weight: bold; font-size: 16px; }
    .title { font-weight: bold; font-size: 20px; }

    .credit {
      font-size: 12px;
      fill: #000;
    }
  </style>

  <script>
    function getParam(name) {
      const params = new URLSearchParams(window.location.search);
      const value = params.get(name) || '';
      // Decode URL entities and escape HTML
      return value
        .replaceAll('+', ' ')
        .replace(/%26/g, '&')
        .replace(/%27/g, "'")
        .replace(/%20/g, ' ')
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }
  </script>
</head>

<body>
  <div id="toolbar">
    <button id="export-btn">Save / Print Pedigree</button>
  </div>

  <div id="container">
    <div id="pedigree-container">
      <svg id="pedigree-svg"
           viewBox="-80 -170 1750 1400"
           preserveAspectRatio="xMidYMid meet"
           xmlns="http://www.w3.org/2000/svg"
           xmlns:xlink="http://www.w3.org/1999/xlink">

        <image
          id="background-image"
          x="-125"
          y="-290"
          width="1800"
          height="1500"
          preserveAspectRatio="xMidYMid meet"
        />

        <g id="header" transform="translate(100, -40)">
          <image
            id="logo"
            x="0"
            y="-40"
            width="140"
            height="140"
            preserveAspectRatio="xMidYMid meet"
          />

          <g transform="translate(160, -10)">
            <text x="0" y="0" text-anchor="start" class="title" data-field="rabbitry"></text>
            <text x="0" y="20" text-anchor="start" class="name" data-field="street"></text>
            <text x="0" y="40" text-anchor="start" class="name" data-chain="city,state,zip"></text>
            <text x="0" y="60" text-anchor="start" class="name" data-field="phone"></text>
            <text x="0" y="80" text-anchor="start" class="name" data-field="email"></text>
            <text x="0" y="110" text-anchor="start" class="name">Breed:</text>
            <text x="60" y="110" text-anchor="start" class="name" data-field="breed"></text>
          </g>
        </g>

        <g transform="translate(20,740)">
          <text class="name" x="40" y="200">I hereby certify that this pedigree is correct to the best of my knowledge.</text>
          <line x1="40" y1="260" x2="350" y2="260" stroke="#000" stroke-width="1" />
          <text class="name" x="40" y="280">Breeder's Signature</text>
        </g>

        <image
          id="signature"
          x="40"
          y="950"
          width="220"
          height="80"
          preserveAspectRatio="xMidYMid meet"
        />

        <rect x="100" y="380" width="220" height="90" class="box"/>
        <text x="110" y="400" text-anchor="left" class="name" data-chain="crabbitry,name"></text>
        <text x="110" y="420" text-anchor="left" class="label">Color:</text>
        <text x="150" y="420" text-anchor="left" data-field="color">  </text>
        <text x="110" y="440" text-anchor="left" class="label">Ear#:</text>
        <text x="150" y="440" text-anchor="left" data-field="ear number"></text>
        <text x="270" y="440" text-anchor="left" class="label">Weight:</text>
        <text x="320" y="440" text-anchor="left" data-field="weight"></text>
        <text x="110" y="460" text-anchor="left" class="label">Sex:</text>
        <text x="150" y="460" text-anchor="left" data-field="sex"></text>
        <text x="270" y="460" text-anchor="left" class="label">Legs:</text>
        <text x="310" y="460" text-anchor="left" data-field="legs"> </text>
        <text x="110" y="480" text-anchor="left" class="label">Reg#:</text>
        <text x="150" y="480" text-anchor="left" data-field="reg"></text>
        <text x="270" y="480" text-anchor="left" class="label">GC#:</text>
        <text x="310" y="480" text-anchor="left" data-field="gc"></text>
        <text x="110" y="500" text-anchor="left" class="label">DOB:</text>
        <text x="150" y="500" text-anchor="left" data-field="dob"></text>

        <line x1="420" y1="440" x2="450" y2="165" stroke="black"/>
        <line x1="420" y1="440" x2="450" y2="715" stroke="black"/>

        <rect x="450" y="100" width="220" height="90" class="box male" data-slot="sire"/>
        <text x="460" y="120" text-anchor="left" class="name" data-chain="srabbitry,sire"></text>
        <text x="460" y="140" text-anchor="left" class="label">Color:</text>
        <text x="500" y="140" text-anchor="left" data-field="scolor">  </text>
        <text x="460" y="160" text-anchor="left" class="label">Ear#:</text>
        <text x="500" y="160" text-anchor="left" data-field="sear"></text>
        <text x="620" y="160" text-anchor="left" class="label">Weight:</text>
        <text x="680" y="160" text-anchor="left" data-field="sweight"></text>
        <text x="460" y="180" text-anchor="left" class="label">Sex:</text>
        <text x="500" y="180" text-anchor="left" data-field="ssex"></text>
        <text x="620" y="180" text-anchor="left" class="label">Legs:</text>
        <text x="680" y="180" text-anchor="left" data-field="slegs"> </text>
        <text x="460" y="200" text-anchor="left" class="label">Reg#:</text>
        <text x="500" y="200" text-anchor="left" data-field="sreg"></text>
        <text x="620" y="200" text-anchor="left" class="label">GC#:</text>
        <text x="680" y="200" text-anchor="left" data-field="sgc"></text>
        <text x="460" y="220" text-anchor="left" class="label">DOB:</text>
        <text x="500" y="220" text-anchor="left" data-field="sdob"></text>

        <line x1="770" y1="165" x2="800" y2="35" stroke="black"/>
        <line x1="770" y1="165" x2="800" y2="300" stroke="black"/>

        <rect x="450" y="650" width="200" height="90" class="box female"/>
        <text x="460" y="670" text-anchor="left" class="name" data-chain="drabbitry,dam"></text>
        <text x="460" y="690" text-anchor="left" class="label">Color:</text>
        <text x="500" y="690" text-anchor="left" data-field="dcolor">  </text>
        <text x="460" y="710" text-anchor="left" class="label">Ear#:</text>
        <text x="500" y="710" text-anchor="left" data-field="dear">Sex:</text>
        <text x="620" y="710" text-anchor="left" class="label">Weight:</text>
        <text x="680" y="710" text-anchor="left" data-field="dweight"></text>
        <text x="460" y="730" text-anchor="left" class="label">Sex:</text>
        <text x="500" y="730" text-anchor="left" data-field="dsex"></text>
        <text x="620" y="730" text-anchor="left" class="label">Legs:</text>
        <text x="680" y="730" text-anchor="left" data-field="dlegs"> </text>
        <text x="460" y="750" text-anchor="left" class="label">Reg#:</text>
        <text x="500" y="750" text-anchor="left" data-field="dreg"></text>
        <text x="620" y="750" text-anchor="left" class="label">GC#:</text>
        <text x="680" y="750" text-anchor="left" data-field="dgc"></text>
        <text x="460" y="770" text-anchor="left" class="label">DOB:</text>
        <text x="500" y="770" text-anchor="left" data-field="ddob"></text>

        <line x1="770" y1="715" x2="800" y2="580" stroke="black"/>
        <line x1="770" y1="715" x2="800" y2="850" stroke="black"/>

        <rect x="800" y="-35" width="200" height="90" class="box male"/>
        <text x="810" y="-15" text-anchor="left" class="name" data-chain="ssrabbitry,ssire"></text>
        <text x="810" y="5" text-anchor="left" class="label">Color:</text>
        <text x="850" y="5" text-anchor="left" data-field="sscolor">  </text>
        <text x="810" y="25" text-anchor="left" class="label">Ear#:</text>
        <text x="850" y="25" text-anchor="left" data-field="ssear"></text>
        <text x="980" y="25" text-anchor="left" class="label">Weight:</text>
        <text x="1030" y="25" text-anchor="left" data-field="ssweight"></text>
        <text x="810" y="45" text-anchor="left" class="label">Sex:</text>
        <text x="850" y="45" text-anchor="left" data-field="sssex"></text>
        <text x="980" y="45" text-anchor="left" class="label">Legs:</text>
        <text x="1030" y="45" text-anchor="left" data-field="sslegs"> </text>
        <text x="810" y="65" text-anchor="left" class="label">Reg#:</text>
        <text x="850" y="65" text-anchor="left" data-field="ssreg"></text>
        <text x="980" y="65" text-anchor="left" class="label">GC#:</text>
        <text x="1030" y="65" text-anchor="left" data-field="ssgc"></text>
        <text x="810" y="85" text-anchor="left" class="label">DOB:</text>
        <text x="850" y="85" text-anchor="left" data-field="ssdob"></text>

        <line x1="1120" y1="35" x2="1150" y2="-35" stroke="black"/>
        <line x1="1120" y1="35" x2="1150" y2="100" stroke="black"/>

        <rect x="800" y="235" width="200" height="90" class="box female"/>
        <text x="810" y="255" text-anchor="left" class="name" data-chain="sdrabbitry,sdam"></text>
        <text x="810" y="275" text-anchor="left" class="label">Color:</text>
        <text x="850" y="275" text-anchor="left" data-field="sdcolor">  </text>
        <text x="810" y="295" text-anchor="left" class="label">Ear#:</text>
        <text x="850" y="295" text-anchor="left" data-field="sdear"></text>
        <text x="980" y="295" text-anchor="left" class="label">Weight:</text>
        <text x="1030" y="295" text-anchor="left" data-field="sdweight"></text>
        <text x="810" y="315" text-anchor="left" class="label">Sex:</text>
        <text x="850" y="315" text-anchor="left" data-field="sdsex"></text>
        <text x="980" y="315" text-anchor="left" class="label">Legs:</text>
        <text x="1030" y="315" text-anchor="left" data-field="sdlegs"> </text>
        <text x="810" y="335" text-anchor="left" class="label">Reg#:</text>
        <text x="850" y="335" text-anchor="left" data-field="sdreg"></text>
        <text x="980" y="335" text-anchor="left" class="label">GC#:</text>
        <text x="1030" y="335" text-anchor="left" data-field="sdgc"></text>
        <text x="810" y="355" text-anchor="left" class="label">DOB:</text>
        <text x="850" y="355" text-anchor="left" data-field="sddob"></text>

        <line x1="1120" y1="300" x2="1150" y2="235" stroke="black"/>
        <line x1="1120" y1="300" x2="1150" y2="370" stroke="black"/>

        <rect x="800" y="515" width="200" height="90" class="box male"/>
        <text x="810" y="535" text-anchor="left" class="name" data-chain="dsrabbitry,dsire"></text>
        <text x="810" y="555" text-anchor="left" class="label">Color:</text>
        <text x="850" y="555" text-anchor="left" data-field="dscolor">  </text>
        <text x="810" y="575" text-anchor="left" class="label">Ear#:</text>
        <text x="850" y="575" text-anchor="left" data-field="dsear"></text>
        <text x="980" y="575" text-anchor="left" class="label">Weight:</text>
        <text x="1030" y="575" text-anchor="left" data-field="dsweight"></text>
        <text x="810" y="595" text-anchor="left" class="label">Sex:</text>
        <text x="850" y="595" text-anchor="left" data-field="dssex"></text>
        <text x="980" y="595" text-anchor="left" class="label">Legs:</text>
        <text x="1030" y="595" text-anchor="left" data-field="dslegs"> </text>
        <text x="810" y="615" text-anchor="left" class="label">Reg#:</text>
        <text x="850" y="615" text-anchor="left" data-field="dsreg"></text>
        <text x="980" y="615" text-anchor="left" class="label">GC#:</text>
        <text x="1030" y="615" text-anchor="left" data-field="dsgc"></text>
        <text x="810" y="635" text-anchor="left" class="label">DOB:</text>
        <text x="850" y="635" text-anchor="left" data-field="dsdob"></text>

        <line x1="1120" y1="580" x2="1150" y2="515" stroke="black"/>
        <line x1="1120" y1="580" x2="1150" y2="650" stroke="black"/>

        <rect x="800" y="785" width="200" height="90" class="box female"/>
        <text x="810" y="805" text-anchor="left" class="name" data-chain="ddrabbitry,ddam"></text>
        <text x="810" y="825" text-anchor="left" class="label">Color:</text>
        <text x="850" y="825" text-anchor="left" data-field="ddcolor">  </text>
        <text x="810" y="845" text-anchor="left" class="label">Ear#:</text>
        <text x="850" y="845" text-anchor="left" data-field="ddear"></text>
        <text x="980" y="845" text-anchor="left" class="label">Weight:</text>
        <text x="1030" y="845" text-anchor="left" data-field="ddweight"></text>
        <text x="810" y="865" text-anchor="left" class="label">Sex:</text>
        <text x="850" y="865" text-anchor="left" data-field="ddsex"></text>
        <text x="980" y="865" text-anchor="left" class="label">Legs:</text>
        <text x="1030" y="865" text-anchor="left" data-field="ddlegs"> </text>
        <text x="810" y="885" text-anchor="left" class="label">Reg#:</text>
        <text x="850" y="885" text-anchor="left" data-field="ddreg"></text>
        <text x="980" y="885" text-anchor="left" class="label">GC#:</text>
        <text x="1030" y="885" text-anchor="left" data-field="ddgc"></text>
        <text x="810" y="905" text-anchor="left" class="label">DOB:</text>
        <text x="850" y="905" text-anchor="left" data-field="dddob"></text>

        <line x1="1120" y1="850" x2="1150" y2="785" stroke="black"/>
        <line x1="1120" y1="850" x2="1150" y2="920" stroke="black"/>

        <rect x="1150" y="-100" width="200" height="90" class="box male"/>
        <text x="1160" y="-80" text-anchor="left" class="name" data-chain="sssrabbitry,sssire"></text>
        <text x="1160" y="-60" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="-60" text-anchor="left" data-field="ssscolor">  </text>
        <text x="1160" y="-40" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="-40" text-anchor="left" data-field="sssear"></text>
        <text x="1330" y="-40" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="-40" text-anchor="left" data-field="sssweight"></text>
        <text x="1160" y="-20" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="-20" text-anchor="left" data-field="ssssex"></text>
        <text x="1330" y="-20" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="-20" text-anchor="left" data-field="ssslegs"> </text>
        <text x="1160" y="0" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="0" text-anchor="left" data-field="sssreg"></text>
        <text x="1330" y="0" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="0" text-anchor="left" data-field="sssgc"></text>
        <text x="1160" y="20" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="20" text-anchor="left" data-field="sssdob"></text>

        <rect x="1150" y="35" width="200" height="90" class="box female"/>
        <text x="1160" y="55" text-anchor="left" class="name" data-chain="ssdrabbitry,ssdam"></text>
        <text x="1160" y="75" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="75" text-anchor="left" data-field="ssdcolor">  </text>
        <text x="1160" y="95" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="95" text-anchor="left" data-field="ssdear"></text>
        <text x="1330" y="95" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="95" text-anchor="left" data-field="ssdweight"></text>
        <text x="1160" y="115" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="115" text-anchor="left" data-field="ssdsex"></text>
        <text x="1330" y="115" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="115" text-anchor="left" data-field="ssdlegs"> </text>
        <text x="1160" y="135" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="135" text-anchor="left" data-field="ssdreg"></text>
        <text x="1330" y="135" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="135" text-anchor="left" data-field="ssdgc"></text>
        <text x="1160" y="155" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="155" text-anchor="left" data-field="ssddob"></text>

        <rect x="1150" y="170" width="200" height="90" class="box male"/>
        <text x="1160" y="190" text-anchor="left" class="name" data-chain="sdsrabbitry,sdsire"></text>
        <text x="1160" y="210" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="210" text-anchor="left" data-field="sdscolor">  </text>
        <text x="1160" y="230" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="230" text-anchor="left" data-field="sdsear"></text>
        <text x="1330" y="230" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="230" text-anchor="left" data-field="sdsweight"></text>
        <text x="1160" y="250" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="250" text-anchor="left" data-field="sdssex"></text>
        <text x="1330" y="250" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="250" text-anchor="left" data-field="sdslegs"> </text>
        <text x="1160" y="270" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="270" text-anchor="left" data-field="sdsreg"></text>
        <text x="1330" y="270" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="270" text-anchor="left" data-field="sdsgc"></text>
        <text x="1160" y="290" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="290" text-anchor="left" data-field="sdsdob"></text>

        <rect x="1150" y="305" width="200" height="90" class="box female"/>
        <text x="1160" y="325" text-anchor="left" class="name" data-chain="sddrabbitry,sddam"></text>
        <text x="1160" y="345" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="345" text-anchor="left" data-field="sddcolor">  </text>
        <text x="1160" y="365" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="365" text-anchor="left" data-field="sddear"></text>
        <text x="1330" y="365" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="365" text-anchor="left" data-field="sddweight"></text>
        <text x="1160" y="385" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="385" text-anchor="left" data-field="sddsex"></text>
        <text x="1330" y="385" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="385" text-anchor="left" data-field="sddlegs"> </text>
        <text x="1160" y="405" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="405" text-anchor="left" data-field="sddreg"></text>
        <text x="1330" y="405" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="405" text-anchor="left" data-field="sddgc"></text>
        <text x="1160" y="425" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="425" text-anchor="left" data-field="sdddob"></text>

        <rect x="1150" y="450" width="200" height="90" class="box male"/>
        <text x="1160" y="470" text-anchor="left" class="name" data-chain="dssrabbitry,dssire"></text>
        <text x="1160" y="490" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="490" text-anchor="left" data-field="dsscolor">  </text>
        <text x="1160" y="510" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="510" text-anchor="left" data-field="dssear"></text>
        <text x="1330" y="510" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="510" text-anchor="left" data-field="dssweight"></text>
        <text x="1160" y="530" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="530" text-anchor="left" data-field="dsssex"></text>
        <text x="1330" y="530" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="530" text-anchor="left" data-field="dsslegs"> </text>
        <text x="1160" y="550" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="550" text-anchor="left" data-field="dssreg"></text>
        <text x="1330" y="550" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="550" text-anchor="left" data-field="dssgc"></text>
        <text x="1160" y="570" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="570" text-anchor="left" data-field="dssdob"></text>

        <rect x="1150" y="585" width="200" height="90" class="box female"/>
        <text x="1160" y="605" text-anchor="left" class="name" data-chain="dsdrabbitry,dsdam"></text>
        <text x="1160" y="625" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="625" text-anchor="left" data-field="dsdcolor">  </text>
        <text x="1160" y="645" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="645" text-anchor="left" data-field="dsdear"></text>
        <text x="1330" y="645" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="645" text-anchor="left" data-field="dsdweight"></text>
        <text x="1160" y="665" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="665" text-anchor="left" data-field="dsdsex"></text>
        <text x="1330" y="665" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="665" text-anchor="left" data-field="dsdlegs"> </text>
        <text x="1160" y="685" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="685" text-anchor="left" data-field="dsdreg"></text>
        <text x="1330" y="685" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="685" text-anchor="left" data-field="dsdgc"></text>
        <text x="1160" y="705" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="705" text-anchor="left" data-field="dsddob"></text>

        <rect x="1150" y="720" width="200" height="90" class="box male"/>
        <text x="1160" y="740" text-anchor="left" class="name" data-chain="ddsrabbitry,ddsire"></text>
        <text x="1160" y="760" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="760" text-anchor="left" data-field="ddscolor">  </text>
        <text x="1160" y="780" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="780" text-anchor="left" data-field="ddsear"></text>
        <text x="1330" y="780" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="780" text-anchor="left" data-field="ddsweight"></text>
        <text x="1160" y="800" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="800" text-anchor="left" data-field="ddssex"></text>
        <text x="1330" y="800" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="800" text-anchor="left" data-field="ddslegs"> </text>
        <text x="1160" y="820" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="820" text-anchor="left" data-field="ddsreg"></text>
        <text x="1330" y="820" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="820" text-anchor="left" data-field="ddsgc"></text>
        <text x="1160" y="840" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="840" text-anchor="left" data-field="ddsdob"></text>

        <rect x="1150" y="855" width="200" height="90" class="box female"/>
        <text x="1160" y="875" text-anchor="left" class="name" data-chain="dddrabbitry,dddam"></text>
        <text x="1160" y="895" text-anchor="left" class="label">Color:</text>
        <text x="1200" y="895" text-anchor="left" data-field="dddcolor">  </text>
        <text x="1160" y="915" text-anchor="left" class="label">Ear#:</text>
        <text x="1200" y="915" text-anchor="left" data-field="dddear"></text>
        <text x="1330" y="915" text-anchor="left" class="label">Weight:</text>
        <text x="1380" y="915" text-anchor="left" data-field="dddweight"></text>
        <text x="1160" y="935" text-anchor="left" class="label">Sex:</text>
        <text x="1200" y="935" text-anchor="left" data-field="dddsex"></text>
        <text x="1330" y="935" text-anchor="left" class="label">Legs:</text>
        <text x="1380" y="935" text-anchor="left" data-field="dddlegs"> </text>
        <text x="1160" y="955" text-anchor="left" class="label">Reg#:</text>
        <text x="1200" y="955" text-anchor="left" data-field="dddreg"></text>
        <text x="1330" y="955" text-anchor="left" class="label">GC#:</text>
        <text x="1380" y="955" text-anchor="left" data-field="dddgc"></text>
        <text x="1160" y="975" text-anchor="left" class="label">DOB:</text>
        <text x="1200" y="975" text-anchor="left" data-field="ddddob"></text>

        <text
          id="pedigree-credit"
          class="credit"
          x="1150"
          y="1000"
          text-anchor="end"
          aria-label="Pedigree credit">
          Pedigree built on the ShowTails LLC platform - www.showtails.com
        </text>

      </svg>
    </div>
  </div>

  <!-- Your existing data-binding script -->
  <script src="pedigree.js"></script>

  <!-- Load logo/signature/background via query params -->
  <script>
    const params = new URLSearchParams(window.location.search);

    function setSvgImage(id, paramName) {
      const url = params.get(paramName);
      if (!url) return;
      const decoded = decodeURIComponent(url);
      const el = document.getElementById(id);
      if (!el) return;

      // Set both modern and legacy attributes for cross-browser support
      el.setAttribute('href', decoded);
      el.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', decoded);
    }

    setSvgImage('logo', 'logo');
    setSvgImage('signature', 'signature');
    setSvgImage('background-image', 'background-image');
  </script>

  <!-- Android-safe export to PNG (print/share reliably) -->
  <script>
    document.getElementById("export-btn").addEventListener("click", async () => {
      const svg = document.getElementById("pedigree-svg");

      // Ensure any async image bindings have a moment to paint
      await new Promise(r => setTimeout(r, 50));

      // Serialize SVG
      const serializer = new XMLSerializer();
      let svgData = serializer.serializeToString(svg);

      // Ensure xmlns is present in serialized markup (some WebViews omit it)
      if (!svgData.includes('xmlns="http://www.w3.org/2000/svg"')) {
        svgData = svgData.replace('<svg', '<svg xmlns="http://www.w3.org/2000/svg"');
      }
      if (!svgData.includes('xmlns:xlink="http://www.w3.org/1999/xlink"')) {
        svgData = svgData.replace('<svg', '<svg xmlns:xlink="http://www.w3.org/1999/xlink"');
      }

      // Hi-res canvas for printing
      const canvas = document.createElement("canvas");
      canvas.width = 3300;  // ~300dpi-ish landscape
      canvas.height = 2550;
      const ctx = canvas.getContext("2d");

      const img = new Image();

      // Important: make blob URL from SVG
      const blob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
      const url = URL.createObjectURL(blob);

      img.onload = () => {
        // White background
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Draw
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        URL.revokeObjectURL(url);

        // Convert to PNG and open in new tab (Android can Print/Share from there)
        const png = canvas.toDataURL("image/png");

        const win = window.open();
        if (!win) {
          alert("Please allow pop-ups so ShowTails can open the pedigree image for printing.");
          return;
        }
        win.document.write(`
          <!DOCTYPE html>
          <html>
          <head>
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <title>Pedigree Image</title>
            <style>
              html, body { margin:0; padding:0; background:white; }
              img { width:100%; height:auto; display:block; }
              .hint { font-family: Arial, sans-serif; padding: 10px; text-align:center; color:#333; }
            </style>
          </head>
          <body>
            <div class="hint">Use your browser menu to <b>Print</b> or <b>Share</b> this pedigree.</div>
            <img src="${png}" alt="Pedigree PNG" />
          </body>
          </html>
        `);
        win.document.close();
      };

      img.onerror = () => {
        URL.revokeObjectURL(url);
        alert("Unable to export pedigree image. If your background/logo are hosted with hotlink protection, try hosting them on the same domain as this page.");
      };

      img.src = url;
    });
  </script>

  <!-- Optional: Keep your Glide click messaging (works if you still want it) -->
  <script>
    document.querySelectorAll('.box').forEach(box => {
      box.style.cursor = 'pointer';
      box.addEventListener('click', () => {
        const slot = box.getAttribute('data-slot');
        if (!slot) return;
        window.parent.postMessage({ pedigreeEdit: slot }, '*');
        box.style.stroke = '#00aaff';
        setTimeout(() => (box.style.stroke = 'black'), 300);
      });
    });
  </script>

</body>
</html>
